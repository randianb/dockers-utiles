version: "3.7"

services:

  nginx:
    build:
      context: ./
      dockerfile: ./build/nginx.dockerfile
      args:
        - PYTHON1_PUERTO=${PYTHON1_PUERTO}
        - PYTHON2_PUERTO=${PYTHON2_PUERTO}
        - NGINX_PORT=${NGINX_PORT}
        - NGINX_NOMBRE_UPSTREAM=${NGINX_NOMBRE_UPSTREAM}

    restart: always
    env_file: .env

    volumes:
      - ./volumes/nginx/config:/etc/nginx/conf.d/
      - ./volumes/nginx/logs:/var/log/nginx/log
    
    ports:
      - ${NGINX_PORT}:${NGINX_PORT}


  python1:
    build:
      context: ./
      dockerfile: ./build/python1.dockerfile
      args:
        - PYTHON1_NOMBRE_CARPETA_PROYECTO=${PYTHON1_NOMBRE_CARPETA_PROYECTO}
        - PYTHON1_PUERTO=${PYTHON1_PUERTO}

    env_file: .env
    restart: always

    volumes:
      - ./volumes/python1/${PYTHON1_NOMBRE_CARPETA_PROYECTO}:/usr/src/

    ports:
      - ${PYTHON1_PUERTO}:${PYTHON1_PUERTO}


  python2:
    build:
      context: ./
      dockerfile: ./build/python2.dockerfile
      args:
        - PYTHON2_NOMBRE_CARPETA_PROYECTO=${PYTHON2_NOMBRE_CARPETA_PROYECTO}
        - PYTHON2_PUERTO=${PYTHON2_PUERTO}

    env_file: .env
    restart: always

    volumes:
      - ./volumes/python2/${PYTHON2_NOMBRE_CARPETA_PROYECTO}:/usr/src/

    ports:
      - ${PYTHON2_PUERTO}:${PYTHON2_PUERTO}